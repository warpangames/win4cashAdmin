<%- include("include/header.ejs") -%>
<main id="main" class="main">
    <div class="pagetitle">
        <h1>Data Tables</h1>
    </div><!-- End Page Title -->
    <div class="d-flex" style="justify-content: flex-end;">
        <!-- <button class="btn btn-sm btn-success m-1" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">Add +</button> -->
    </div>
    <section class="section">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <!-- Table with stripped rows -->
                        <table class="table datatable" id="withdrawTable1">
                            <thead>
                                <tr>
                                    <th scope="col">S.No.</th>
                                    <th scope="col">Mobile</th>
                                    <th scope="col">Username</th>
                                    <th scope="col">Amount</th>
                                    <th scope="col">BankName</th>
                                    <th scope="col">IFSC</th>
                                    <th scope="col">Acc.No</th>
                                    <th scope="col">Date</th>
                                    <th scope="col">GST</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
                        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                const tableBody = document.querySelector('#withdrawTable1 tbody');

                                fetch('http://localhost:7000/admin/acceptreq')
                                    .then(response => response.json())
                                    .then(data => {
                                        console.log(data, 'data');
                                        data.forEach((user, index) => {
                                            if (true) {
                                                const tableRow = document.createElement('tr');
                                                tableRow.innerHTML = `
                                                    <td>${index + 1}</td>
                                                    <td>${user.details.phoneno}</td>
                                                    <td>${user.Username}</td>
                                                    <td id="withdrawAmount">${user.Requestedammount}</td>
                                                    <td>${user.details.bankname}</td>
                                                    <td>${user.details.IFSC || '0'}</td>
                                                    <td>${user.details.Accountno}</td>
                                                    <td>${new Date(user.createdAt).toLocaleString()}</td>
                                                     <td>${(user.Requestedammount)*0.18}</td>
                                                    <td>
                                                        <button class="btn btn-success btn-sm confirm-btn" data-username="${user.Username}">Delete Data</button>
                                                       
                                                    </td>
                                                `;
                                                tableBody.appendChild(tableRow);
                                            }
                                        });

                                        // Add event listeners for confirm and reject buttons
                                        document.querySelectorAll('.confirm-btn').forEach(button => {
                                            button.addEventListener('click', function () {
                                                const username = this.getAttribute('data-username');
                                                handleAction(username, 'confirm');
                                            });
                                        });

                                        document.querySelectorAll('.reject-btn').forEach(button => {
                                            button.addEventListener('click', function () {
                                                const username = this.getAttribute('data-username');
                                                handleAction(username, 'reject');
                                            });
                                        });
                                    })
                                    .catch(error => console.error('Error fetching data:', error));
                            });

                            function handleAction(username, action) {
                                const actionText = action === 'confirm' ? 'confirm' : 'reject';
                                if (confirm(`Are you sure you want to ${actionText} the request for ${username}?`)) {
                                    axios.post(`http://localhost:7000/admin/deleteall`, { Username:username })
                                        .then(response => {
                                          console.log(response);
                                            alert(`Request ${actionText}ed successfully!`);
                                            // location.reload(); // Reload the table data
                                        })
                                        .catch(error => {
                                            console.error(`Error ${actionText}ing request:`, error);
                                            alert(`Failed to ${actionText} the request.`);
                                        });
                                }
                            }
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- deltet modal -->
    <div class="text-center">
        <!-- Button HTML (to Trigger Modal) -->
        <!-- <a >Click to Open Confirm Modal</a> -->
    </div>

    <!-- Modal HTML -->
    <div class="de">
        <div id="myModal" class="modal fade">
            <div class="modal-dialog modal-confirm">
                <div class="modal-content">
                    <i class="bi bi-exclamation-circle text-danger" style="font-size:2rem"></i>
                    <!-- <div class="modal-header">
                        <div class="icon-box">
                            <i class="bi bi-twitter-x">X</i>
                            <i class="material-icons"></i>
                        </div>
                        <h4 class="modal-title">Are you sure?</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div> -->
                    <div class="modal-body">
                        <p>Do you really want to delete these records? This process cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- deltet modal -->

    <!-- START Modal ADD LOBBIES -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Lobbies</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="">
                        <div class="mb-3">
                            <label for="formGroupExampleInput" class="form-label">Action</label>
                            <input type="text" class="form-control" id="formGroupExampleInput" placeholder="Bot">
                        </div>
                        <button class="btn btn-success">Save</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                </div>
            </div>
        </div>
    </div>
    <!--end Modal ADD LOBBIES -->

    <!-- START Modal edit LOBBIES -->
    <div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Lobbies</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="">
                        <div class="form-group col-md-12 mb-3">
                            <label for="inputState">Action</label>
                            <select id="inputState" class="form-control">
                                <option selected>Choose...</option>
                                <option>approval</option>
                                <option>Reject</option>
                            </select>
                        </div>
                        <button class="btn btn-success">Save</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                </div>
            </div>
        </div>
    </div>
    <!--end Modal edit LOBBIES -->
    <script>
    </script>

</main><!-- End #main -->
<!-- <script src="assets/js/main.js"></script> -->
<%- include("include/footer.ejs") -%>
