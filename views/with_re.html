<%-  include("include/header.ejs") -%>
<style>
  .card-table {
      display: none;
  }

  .card {
      margin-bottom: 1rem;
  }

  @media (max-width: 768px) {
      .table {
          display: none;
      }
      .card-table {
          display: block;
      }
  }

  .pagination {
      display: flex;
      justify-content: center;
      margin-top: 1rem;
  }

  .pagination button {
      margin: 0 5px;
      padding: 5px 10px;
      border: 1px solid #007bff;
      background-color: #007bff;
      color: white;
      cursor: pointer;
  }

  .pagination button.disabled {
      cursor: not-allowed;
      opacity: 0.5;
  }

  .pagination button.active {
      background-color: #0056b3;
  }
</style>
</head>
<body>

<section class="container mt-5" style="margin-top: 6rem !important">
<div class="table-responsive" style="width: 100vw;font-size: 12px;">
  <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search...">
  <table class="table" id="withdrawTable">
      <thead>
          <tr>
              <th scope="col">S.NO.</th>
              <th scope="col">Mobile</th>
              <th scope="col">Username</th>
              <th scope="col">Amount</th>
              <th scope="col">BankName</th>
              <th scope="col">IFSC</th>
              <th scope="col">Acc.No</th>
              <th scope="col">Balance</th>
              <th scope="col">Date</th>
              <th scope="col">Status</th>
          </tr>
      </thead>
      <tbody></tbody>
  </table>
  <div id="cardTable" class="card-table"></div>
  <div class="pagination" id="paginationControls"></div>
</div>
</section>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const tableBody = document.querySelector('#withdrawTable tbody');
  const cardTable = document.getElementById('cardTable');
  const searchInput = document.getElementById('searchInput');
  const paginationControls = document.getElementById('paginationControls');

  let currentPage = 1;
  const rowsPerPage = 12;
  let data = [];

  function renderTable(data) {
      tableBody.innerHTML = '';
      cardTable.innerHTML = '';
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = data.slice(start, end);

      pageData.forEach((user, index) => {
          const tableRow = document.createElement('tr');
          tableRow.innerHTML = `
              <td>${start + index + 1}</td>
              <td>${user.details[0].phoneno}</td>
              <td>${user.Username}</td>
              <td>${user.Requestedammount}</td>
              <td>${user.details[0].bankname}</td>
              <td>${user.details[0].IFSC || '0'}</td>
              <td>${user.details[0].Accountno}</td>
              <td>${user.Walletammount}</td>
              <td>${new Date(user.createdAt).toLocaleString()}</td>
              <td>${user.satuts}</td>
          `;
          tableBody.appendChild(tableRow);

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
              <div class="card-body">
                  <h5 class="card-title">Request #${start + index + 1}</h5>
                  <p class="card-text"><strong>Mobile:</strong> ${user.details[0].phoneno}</p>
                  <p class="card-text"><strong>Username:</strong> ${user.Username}</p>
                  <p class="card-text"><strong>Amount:</strong> ${user.Requestedammount}</p>
                  <p class="card-text"><strong>BankName:</strong> ${user.details[0].bankname}</p>
                  <p class="card-text"><strong>IFSC:</strong> ${user.details[0].IFSC || '0'}</p>
                  <p class="card-text"><strong>Acc.No:</strong> ${user.details[0].Accountno}</p>
                  <p class="card-text"><strong>Balance:</strong> ${user.Walletammount}</p>
                  <p class="card-text"><strong>Date:</strong> ${new Date(user.createdAt).toLocaleString()}</p>
                  <p class="card-text"><strong>Status:</strong> ${user.satuts}</p>
              </div>
          `;
          cardTable.appendChild(card);
      });
  }

  function renderPagination(totalRows) {
      paginationControls.innerHTML = '';
      const totalPages = Math.ceil(totalRows / rowsPerPage);

      for (let i = 1; i <= totalPages; i++) {
          const button = document.createElement('button');
          button.textContent = i;
          button.className = i === currentPage ? 'active' : '';
          button.addEventListener('click', () => {
              currentPage = i;
              renderTable(data);
              renderPagination(data.length);
          });
          paginationControls.appendChild(button);
      }
  }

  function filterData(searchTerm) {
      return data.filter(user => 
          user.details[0].phoneno.includes(searchTerm) ||
          user.Username.toLowerCase().includes(searchTerm.toLowerCase()) ||
          user.Requestedammount.toString().includes(searchTerm) ||
          user.details[0].bankname.toLowerCase().includes(searchTerm.toLowerCase()) ||
          user.details[0].IFSC.toLowerCase().includes(searchTerm.toLowerCase()) ||
          user.details[0].Accountno.includes(searchTerm) ||
          user.Walletammount.toString().includes(searchTerm) ||
          new Date(user.createdAt).toLocaleString().includes(searchTerm) ||
          user.satuts.toLowerCase().includes(searchTerm.toLowerCase())
      );
  }

  searchInput.addEventListener('input', function () {
      const searchTerm = searchInput.value;
      const filteredData = filterData(searchTerm);
      currentPage = 1;
      renderTable(filteredData);
      renderPagination(filteredData.length);
  });

  fetch('https://win4cash.in/admin/pendingreq')
      .then(response => response.json())
      .then(responseData => {
          data = responseData;
          renderTable(data);
          renderPagination(data.length);
      })
      .catch(error => console.error('Error fetching data:', error));
});
</script>

  
<%- include("include/footer.ejs") -%>